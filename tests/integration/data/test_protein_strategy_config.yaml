# Test configuration for YAML strategy integration tests

entity_types:
  test_protein:
    description: "Test protein entity type"
    version: "1.0"
    example_identifiers: ["TEST1", "P12345", "HGNC:1234"]

ontologies:
  hgnc:
    name: "HGNC"
    description: "HUGO Gene Nomenclature Committee - Test"
  uniprot:
    name: "UniProt"
    description: "Universal Protein Resource - Test"
  ensembl:
    name: "Ensembl"
    description: "Ensembl genome database - Test"

databases:
  test_uniprot:
    endpoint:
      name: "test_target"
      description: "Test target endpoint"
      type: "file_tsv"
      connection_details:
        file_path: "tests/integration/data/mock_client_files/test_uniprot.tsv"
        delimiter: "\t"
    properties:
      primary: "uniprot"
      mappings:
        uniprot:
          column: "Entry"
          ontology_type: "uniprot"
        hgnc:
          column: "Gene Names"
          ontology_type: "hgnc"
          
  test_hgnc:
    endpoint:
      name: "test_source"
      description: "Test source endpoint"
      type: "file_tsv"
      connection_details:
        file_path: "tests/integration/data/mock_client_files/test_hgnc.tsv"
        delimiter: "\t"
    properties:
      primary: "hgnc"
      mappings:
        hgnc_id:
          column: "hgnc_id"
          ontology_type: "hgnc"
        symbol:
          column: "symbol"
          ontology_type: "hgnc"

# Additional mapping resources  
additional_resources:
  - name: "test_uniprot_mapper"
    client_class_path: "biomapper.mapping.clients.generic_file_client.GenericFileLookupClient"
    input_ontology_type: "hgnc"
    output_ontology_type: "uniprot"
    config:
      file_path: "tests/integration/data/mock_client_files/test_uniprot.tsv"
      key_column: "Gene Names"
      value_column: "Entry"
      delimiter: "\t"
      
  - name: "test_hgnc_mapper"
    client_class_path: "biomapper.mapping.clients.generic_file_client.GenericFileLookupClient"
    input_ontology_type: "hgnc"
    output_ontology_type: "hgnc"
    config:
      file_path: "tests/integration/data/mock_client_files/test_hgnc.tsv"
      key_column: "symbol"
      value_column: "hgnc_id"
      delimiter: "\t"
      
  - name: "test_filter_target"
    client_class_path: "biomapper.mapping.clients.generic_file_client.GenericFileLookupClient"
    input_ontology_type: "generic"
    output_ontology_type: "generic"
    config:
      file_path: "tests/integration/data/mock_client_files/test_filter_target.csv"
      key_column: "id"
      value_column: "name"
      delimiter: ","

# Mapping paths for the test entity
mapping_paths:
  - name: "gene_to_uniprot"
    description: "Map gene symbols to UniProt IDs"
    source_type: "hgnc"
    target_type: "uniprot"
    priority: 1
    steps:
      - resource: "test_uniprot_mapper"
        order: 1
        
  - name: "hgnc_to_gene"
    description: "Extract gene symbol from HGNC ID"
    source_type: "hgnc"
    target_type: "hgnc"
    priority: 1
    steps:
      - resource: "test_hgnc_mapper"
        order: 1

# Mapping strategies for test entity
mapping_strategies:
  basic_linear_strategy:
    description: "Simple linear conversion strategy"
    steps:
      - step_id: "S1_CONVERT_TO_GENE"
        description: "Convert HGNC IDs to gene symbols"
        action:
          type: "CONVERT_IDENTIFIERS_LOCAL"
          endpoint_context: "SOURCE"
          mapping_path_name: "hgnc_to_gene"
          output_ontology_type: "hgnc"
      
      - step_id: "S2_GENE_TO_UNIPROT"
        description: "Convert gene symbols to UniProt IDs"
        action:
          type: "CONVERT_IDENTIFIERS_LOCAL"
          endpoint_context: "TARGET"
          mapping_path_name: "gene_to_uniprot"
          output_ontology_type: "uniprot"
  
  strategy_with_path_execution:
    description: "Strategy using EXECUTE_MAPPING_PATH"
    steps:
      - step_id: "S1_EXECUTE_PATH"
        description: "Execute gene to UniProt mapping path"
        action:
          type: "EXECUTE_MAPPING_PATH"
          path_name: "gene_to_uniprot"
          pass_unmapped: true
  
  strategy_with_filter:
    description: "Strategy with filtering step"
    steps:
      - step_id: "S1_FILTER"
        description: "Filter identifiers by target presence"
        action:
          type: "FILTER_IDENTIFIERS_BY_TARGET_PRESENCE"
          endpoint_context: "TARGET"
          ontology_type_to_match: "uniprot"
          resource_name_for_check: "test_filter_target"
          include_if_present: true
          pass_through_on_failure: false
  
  complex_mixed_strategy:
    description: "Strategy combining multiple action types"
    steps:
      - step_id: "S1_CONVERT_HGNC"
        description: "Convert HGNC IDs to gene symbols"
        action:
          type: "CONVERT_IDENTIFIERS_LOCAL"
          endpoint_context: "SOURCE"
          mapping_path_name: "hgnc_to_gene"
          output_ontology_type: "hgnc"
      
      - step_id: "S2_EXECUTE_PATH"
        description: "Execute gene to UniProt mapping path"
        action:
          type: "EXECUTE_MAPPING_PATH"
          path_name: "gene_to_uniprot"
          pass_unmapped: false
      
      - step_id: "S3_FILTER_RESULTS"
        description: "Filter by target presence"
        action:
          type: "FILTER_IDENTIFIERS_BY_TARGET_PRESENCE"
          endpoint_context: "TARGET"
          ontology_type_to_match: "uniprot"
          resource_name_for_check: "test_filter_target"
          include_if_present: true
  
  strategy_with_failing_step:
    description: "Strategy with intentionally failing step"
    steps:
      - step_id: "S1_FAIL_CONVERT"
        description: "Attempt to convert with non-existent resource"
        action:
          type: "CONVERT_IDENTIFIERS_LOCAL"
          endpoint_context: "SOURCE"
          mapping_path_name: "non_existent_path"
          output_ontology_type: "uniprot"
  
  ontology_tracking_strategy:
    description: "Strategy for testing ontology type tracking"
    steps:
      - step_id: "S1_EXTRACT_GENE"
        description: "Extract gene symbol from HGNC ID"
        action:
          type: "CONVERT_IDENTIFIERS_LOCAL"
          endpoint_context: "SOURCE"
          mapping_path_name: "hgnc_to_gene"
          output_ontology_type: "hgnc"
      
      - step_id: "S2_CONVERT_TO_UNIPROT"
        description: "Convert gene symbol to UniProt ID"
        action:
          type: "CONVERT_IDENTIFIERS_LOCAL"
          endpoint_context: "TARGET"
          mapping_path_name: "gene_to_uniprot"
          output_ontology_type: "uniprot"
  
  filter_with_conversion:
    description: "Filter with conversion path to match ontology"
    steps:
      - step_id: "S1_FILTER_WITH_CONV"
        description: "Filter identifiers using conversion path"
        action:
          type: "FILTER_IDENTIFIERS_BY_TARGET_PRESENCE"
          endpoint_context: "TARGET"
          ontology_type_to_match: "hgnc"
          resource_name_for_check: "test_hgnc_mapper"
          include_if_present: true